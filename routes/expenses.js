const express = require('express');

const router = express.Router();

// MOCK 데이터
let expenses = [
  {
    expenseId: 87,
    tripId: 5,
    title: '구찌백 flex',
    category: 'shopping',
    paymentMethod: '카드',
    cost: 400,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 86,
    tripId: 5,
    title: '기부',
    category: 'etc',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 85,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 84,
    tripId: 5,
    title: '비행기',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 83,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 82,
    tripId: 5,
    title: '기부',
    category: 'etc',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 81,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 80,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 79,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 78,
    tripId: 5,
    title: '비행기',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 77,
    tripId: 5,
    title: '잡다한 용품',
    category: 'etc',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 76,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 75,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 74,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 73,
    tripId: 5,
    title: '비행기',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 72,
    tripId: 5,
    title: '잡다한 용품',
    category: 'etc',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 71,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 70,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 69,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 68,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 67,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 66,
    tripId: 5,
    title: '4성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 65,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 64,
    tripId: 5,
    title: '4성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 63,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 62,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 61,
    tripId: 5,
    title: '게스트 하우스',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 60,
    tripId: 5,
    title: '비행기',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 59,
    tripId: 5,
    title: '비행기',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 58,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 57,
    tripId: 5,
    title: '택시',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 56,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 55,
    tripId: 5,
    title: '버스',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 54,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 53,
    tripId: 5,
    title: '버스',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 52,
    tripId: 5,
    title: '버스 정기권',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 51,
    tripId: 5,
    title: '택시',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 50,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 49,
    tripId: 5,
    title: '온천',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 48,
    tripId: 5,
    title: '워터파크',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 47,
    tripId: 5,
    title: '놀이동산',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 46,
    tripId: 5,
    title: '체험',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 45,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 44,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 43,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 42,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 41,
    tripId: 5,
    title: '패러글라이딩',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 21:18',
  },
  {
    expenseId: 40,
    tripId: 5,
    title: '사진첩',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 39,
    tripId: 5,
    title: '텀블러',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 38,
    tripId: 5,
    title: '방어회',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 37,
    tripId: 5,
    title: '누텔라',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 36,
    tripId: 5,
    title: '외국술',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 35,
    tripId: 5,
    title: '기념품',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 34,
    tripId: 5,
    title: '우산',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 33,
    tripId: 5,
    title: '코트',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 32,
    tripId: 5,
    title: '가디건',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 31,
    tripId: 5,
    title: '후드티',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 30,
    tripId: 5,
    title: '제육볶음',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 29,
    tripId: 5,
    title: '한식',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 28,
    tripId: 5,
    title: '망고스틴',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 27,
    tripId: 5,
    title: '컵누들',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 26,
    tripId: 5,
    title: '팟타이',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-04 18:18',
  },
  {
    expenseId: 25,
    tripId: 5,
    title: '소고기',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 24,
    tripId: 5,
    title: '양고기',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 23,
    tripId: 5,
    title: '스테이크',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 22,
    tripId: 5,
    title: '점심 파스타',
    category: 'meal',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 21,
    tripId: 5,
    title: '구찌백',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 20,
    tripId: 5,
    title: '박물관 입장료',
    category: 'tour',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 19,
    tripId: 5,
    title: '우버',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 18,
    tripId: 5,
    title: '5성급 호텔',
    category: 'accommodation',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 17,
    tripId: 5,
    title: '기부',
    category: 'etc',
    paymentMethod: '현금',
    cost: 10,
    date: '2021-11-03 13:18',
  },
  {
    expenseId: 16,
    tripId: 3,
    title: '구찌백 flex',
    category: 'shopping',
    paymentMethod: '카드',
    cost: 400,
    date: '2020-11-10 13:18',
  },
  {
    expenseId: 15,
    tripId: 3,
    title: '기부',
    category: 'etc',
    paymentMethod: '현금',
    cost: 50,
    date: '2020-11-10 13:18',
  },
  {
    expenseId: 14,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 13,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 12,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 11,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 10,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 9,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 8,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 7,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 6,
    tripId: 2,
    title: '가방',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 5,
    tripId: 2,
    title: '기부',
    category: 'etc',
    paymentMethod: '카드',
    cost: 20,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 4,
    tripId: 2,
    title: '옷',
    category: 'shopping',
    paymentMethod: '현금',
    cost: 34,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 3,
    tripId: 2,
    title: '차비',
    category: 'traffic',
    paymentMethod: '현금',
    cost: 45,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 2,
    tripId: 2,
    title: '박물관',
    category: 'tour',
    paymentMethod: '현금',
    cost: 20,
    date: '2021-10-31 13:18',
  },
  {
    expenseId: 1,
    tripId: 2,
    title: '호텔',
    category: 'accommodation',
    paymentMethod: '카드',
    cost: 34,
    date: '2021-10-31 13:18',
  },
];

const generateExpenseId = () => Math.max(...expenses.map(expense => expense.expenseId), 0) + 1;

router.get('/', (req, res) => {
  const { currentIndex, tripId, category } = req.query;
  let expensesList = expenses.filter(expense => expense.tripId === +tripId);

  expensesList = category ? expensesList.filter(expense => expense.category === category) : expensesList;

  const lastIndex = expensesList.length < +currentIndex + 3 ? expensesList.length : +currentIndex + 3;
  expensesList = expensesList.filter((_, index) => index >= currentIndex && index <= lastIndex);

  res.send(expensesList);
});

router.post('/', (req, res) => {
  console.log(req.query.currentIndex);
  const newExpense = { expenseId: generateExpenseId(), ...req.body };
  expenses = [newExpense, ...expenses];

  res.send(expenses);
});

module.exports = router;
